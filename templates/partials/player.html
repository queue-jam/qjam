<audio
  id="audio-element"
  autoplay
  style="display: none"
  hx-post="/play"
  hx-trigger="ended"
  hx-target="#player-container"
  hx-swap="innerHTML"
>
  <source src="{{ stream_url }}" type="audio/mp4" />
</audio>

<div
  style="
    display: flex;
    width: 100%;
    align-items: center;
    justify-content: space-between;
  "
>
  <div
    style="display: flex; align-items: center; gap: 15px; flex: 1; min-width: 0"
  >
    <button id="play-pause-btn" class="play-btn" style="flex-shrink: 0">
      <svg
        id="icon-pause"
        width="18"
        height="18"
        viewBox="0 0 24 24"
        fill="black"
      >
        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
      </svg>
      <svg
        id="icon-play"
        width="18"
        height="18"
        viewBox="0 0 24 24"
        fill="black"
        style="display: none; margin-left: 2px"
      >
        <path d="M8 5v14l11-7z" />
      </svg>
    </button>

    <button
      class="icon-btn"
      hx-post="/play"
      hx-target="#player-container"
      hx-swap="innerHTML"
      style="flex-shrink: 0"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
      </svg>
    </button>

    <div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis">
      <div style="color: white; font-weight: 600; font-size: 0.9rem">
        {{ title }}
      </div>
      <div style="color: #aaa; font-size: 0.8rem">{{ artist }}</div>
    </div>
  </div>

  <div
    style="
      flex: 2;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 0 30px;
    "
  >
    <span
      id="curr-time"
      style="
        color: #aaa;
        font-size: 0.75rem;
        min-width: 35px;
        text-align: right;
      "
      >0:00</span
    >
    <input
      type="range"
      id="seek-slider"
      max="100"
      value="0"
      style="width: 100%"
    />
    <span
      id="total-duration"
      style="color: #aaa; font-size: 0.75rem; min-width: 35px"
      >0:00</span
    >
  </div>

  <div
    style="
      flex: 1;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
    "
  >
    <svg width="20" height="20" viewBox="0 0 24 24" fill="#aaa">
      <path
        d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"
      />
    </svg>
    <input
      type="range"
      id="volume-slider"
      max="100"
      value="100"
      style="width: 80px"
    />
  </div>
</div>

<script>
  (function () {
    const audio = document.getElementById("audio-element");
    const playBtn = document.getElementById("play-pause-btn");
    const iconPlay = document.getElementById("icon-play");
    const iconPause = document.getElementById("icon-pause");
    const seekSlider = document.getElementById("seek-slider");
    const volumeSlider = document.getElementById("volume-slider");
    const currTime = document.getElementById("curr-time");
    const totalDuration = document.getElementById("total-duration");
    if (!audio) return;
    audio.volume = volumeSlider.value / 100;
    playBtn.addEventListener("click", () => {
      if (audio.paused) {
        audio.play();
        iconPlay.style.display = "none";
        iconPause.style.display = "block";
      } else {
        audio.pause();
        iconPlay.style.display = "block";
        iconPause.style.display = "none";
      }
    });
    audio.addEventListener("timeupdate", () => {
      if (audio.duration) {
        seekSlider.value = (100 / audio.duration) * audio.currentTime;
        currTime.textContent = formatTime(audio.currentTime);
        totalDuration.textContent = formatTime(audio.duration);
      }
    });
    seekSlider.addEventListener("input", () => {
      audio.currentTime = (audio.duration / 100) * seekSlider.value;
    });
    volumeSlider.addEventListener("input", () => {
      audio.volume = volumeSlider.value / 100;
    });
    function formatTime(s) {
      const m = Math.floor(s / 60);
      const sc = Math.floor(s % 60);
      return `${m}:${sc < 10 ? "0" : ""}${sc}`;
    }
  })();
</script>
